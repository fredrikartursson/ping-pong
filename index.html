<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pingis Event</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="script.js">
        function createMatchSchedule(players, groupIndex) {
            const scheduleDiv = document.createElement("div");
            scheduleDiv.className = "schedule";
            scheduleDiv.innerHTML = "<h3>Spelordning</h3>";

            // Create match pairs
            const matches = [];
            for (let i = 0; i < players.length - 1; i++) {
                for (let j = i + 1; j < players.length; j++) {
                    const player1 = players[i].name;
                    const player2 = players[j].name;
                    const match = { player1, player2, score1: 0, score2: 0 };
                    matches.push(match);

                    const matchDiv = document.createElement("div");
                    matchDiv.innerHTML = `${player1} vs ${player2}: 
                        <input type="number" placeholder="0" onchange="updateMatchScore(${groupIndex}, ${i}, ${j}, this, 1)" /> - 
                        <input type="number" placeholder="0" onchange="updateMatchScore(${groupIndex}, ${j}, ${i}, this, 2)" />`;
                    scheduleDiv.appendChild(matchDiv);
                }
            }

            // Attach matches to the group
            groups[groupIndex].matches = matches;
            localStorage.setItem('tournaments', JSON.stringify(tournaments));
            return scheduleDiv;
        }
            const scheduleDiv = document.createElement("div");
            scheduleDiv.className = "schedule";
            scheduleDiv.innerHTML = "<h3>Spelordning</h3>";

            // Create match pairs
            const matches = [];
            for (let i = 0; i < players.length - 1; i++) {
                for (let j = i + 1; j < players.length; j++) {
                    const player1 = players[i].name;
                    const player2 = players[j].name;
                    matches.push({ player1, player2, score1: 0, score2: 0 });

                    const matchDiv = document.createElement("div");
                    matchDiv.innerHTML = `${player1} vs ${player2}: 
                        <input type="number" placeholder="0" onchange="updateMatchScore(${groupIndex}, ${i}, ${j}, this, 1)" /> - 
                        <input type="number" placeholder="0" onchange="updateMatchScore(${groupIndex}, ${j}, ${i}, this, 2)" />`;
                    scheduleDiv.appendChild(matchDiv);
                }
            }

            groups[groupIndex].matches = matches;
            localStorage.setItem('tournaments', JSON.stringify(tournaments));
            return scheduleDiv;
        }

        function updateMatchScore(groupIndex, playerIndex1, playerIndex2, inputElement, playerNumber) {
            const tournament = tournaments[0];
            const group = tournament.groups[groupIndex];
            const match = group.matches.find(match => match.player1 === group.players[playerIndex1].name && match.player2 === group.players[playerIndex2].name);

            if (playerNumber === 1) {
                match.score1 = parseInt(inputElement.value) || 0;
            } else {
                match.score2 = parseInt(inputElement.value) || 0;
            }

            localStorage.setItem('tournaments', JSON.stringify(tournaments));
        }

    
        function updateMatchScore(groupIndex, playerIndex1, playerIndex2, inputElement, playerNumber) {
            const tournament = tournaments[0];
            const group = tournament.groups[groupIndex];
            const player1 = group.players[playerIndex1];
            const player2 = group.players[playerIndex2];
            const match = group.matches.find(match => match.player1 === player1.name && match.player2 === player2.name);

            if (playerNumber === 1) {
                match.score1 = parseInt(inputElement.value) || 0;
            } else {
                match.score2 = parseInt(inputElement.value) || 0;
            }

            // Update points
            player1.points = 0;
            player1.won = 0;
            player1.lost = 0;
            player2.points = 0;
            player2.won = 0;
            player2.lost = 0;

            group.matches.forEach(m => {
                const p1 = group.players.find(p => p.name === m.player1);
                const p2 = group.players.find(p => p.name === m.player2);

                if (m.score1 > m.score2) {
                    p1.points += 3;
                    p1.won += 1;
                    p2.lost += 1;
                } else if (m.score2 > m.score1) {
                    p2.points += 3;
                    p2.won += 1;
                    p1.lost += 1;
                } else if (m.score1 === m.score2 && m.score1 !== 0) {
                    p1.points += 1;
                    p2.points += 1;
                }
            });

            // Update table
            const tableBody = document.querySelector(`#group-${groupIndex} tbody`);
            tableBody.innerHTML = group.players.map((player, j) => `
                <tr id="group-${groupIndex}-player-${j}">
                    <td>${player.name}</td>
                    <td>${player.points}</td>
                    <td>${player.won}</td>
                    <td>${player.lost}</td>
                </tr>
            `).join("");

            localStorage.setItem('tournaments', JSON.stringify(tournaments));
        }
    </script>
    <style>
        .logo {
            display: block;
            margin: 20px auto;
            width: 150px;
            border-radius: 10px;
        }
        .player-entry {
            width: 80%;
            margin: 20px auto;
            padding: 20px;
            background-color: #f0f0f0;
            border-radius: 8px;
            text-align: center;
        }
        .player-textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 15px;
            border-radius: 8px;
            padding: 10px;
            font-size: 16px;
        }
        .generate-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .generate-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <img src="pingpong-logo_FINAL.png" alt="Pingis Event Logo" class="logo" />
    <div class="player-entry">
        <h2>Lägg till alla spelare</h2>
        <textarea id="player-names" class="player-textarea" placeholder="Ange en spelare per rad..."></textarea>
        <button class="generate-button" onclick="generateGroupsAndMatches()">Generera Grupper och Spelordning</button>
    </div>

    <div id="groups-container"></div>
    <div id="playoff-container" class="playoff-container"></div>

    <script>
        let players = [];
        let tournaments = JSON.parse(localStorage.getItem('tournaments')) || [];
        const groupColors = ["#FFDDC1", "#FFABAB", "#FFC3A0", "#FF677D", "#D4A5A5", "#97C1A9", "#FF6F61", "#6B4226", "#D9BF77", "#EFC050"];

        function generateGroupsAndMatches() {
            const playerText = document.getElementById("player-names").value.trim();
            if (playerText === "") return alert("Vänligen ange minst en spelare.");

            players = playerText.split(/
+/).map(name => name.trim()).filter(name => name !== "");
            localStorage.setItem('players', JSON.stringify(players));

            const container = document.getElementById("groups-container");
            container.innerHTML = "";
            const groupSize = Math.ceil(players.length / 5);
            const tournamentName = `Turnering ${new Date().toLocaleDateString()}`;
            let groups = [];

            for (let i = 0; i < 5; i++) {
                const groupPlayers = players.slice(i * groupSize, (i + 1) * groupSize).map(player => ({
                    name: player,
                    points: 0,
                    won: 0,
                    lost: 0
                }));

                const groupDiv = document.createElement("div");
                const groupColor = groupColors[Math.floor(Math.random() * groupColors.length)];
                groupDiv.className = "group-container";
                groupDiv.style.backgroundColor = groupColor;
                groupDiv.innerHTML = `<h2>Grupp ${i + 1}</h2>`;

                const table = document.createElement("table");
                table.className = "player-table";
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Spelare</th>
                            <th>Poäng</th>
                            <th>Matcher Vunna</th>
                            <th>Matcher Förlorade</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${groupPlayers.map((player, j) => `
                            <tr id="group-${i}-player-${j}">
                                <td>${player.name}</td>
                                <td>${player.points}</td>
                                <td>${player.won}</td>
                                <td>${player.lost}</td>
                            </tr>`).join("")}
                    </tbody>
                `;

                groupDiv.appendChild(table);
                const matchSchedule = createMatchSchedule(groupPlayers, i);
                groupDiv.appendChild(matchSchedule);
                container.appendChild(groupDiv);

                groups.push({ players: groupPlayers, matches: [] });
            }

            tournaments.push({ name: tournamentName, groups: groups });
            localStorage.setItem('tournaments', JSON.stringify(tournaments));
        }
            const playerText = document.getElementById("player-names").value.trim();
            if (playerText === "") return alert("Vänligen ange minst en spelare.");

            players = playerText.split(/\n+/).map(name => name.trim()).filter(name => name !== "");
            localStorage.setItem('players', JSON.stringify(players));

            const container = document.getElementById("groups-container");
            container.innerHTML = "";
            const groupSize = Math.ceil(players.length / 5);
            const tournamentName = `Turnering ${new Date().toLocaleDateString()}`;
            let groups = [];

            for (let i = 0; i < 5; i++) {
                const groupPlayers = players.slice(i * groupSize, (i + 1) * groupSize).map(player => ({
                    name: player,
                    points: 0,
                    won: 0,
                    lost: 0
                }));

                const groupDiv = document.createElement("div");
                const groupColor = groupColors[Math.floor(Math.random() * groupColors.length)];
                groupDiv.className = "group-container";
                groupDiv.style.backgroundColor = groupColor;
                groupDiv.innerHTML = `<h2>Grupp ${i + 1}</h2>`;

                const table = document.createElement("table");
                table.className = "player-table";
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Spelare</th>
                            <th>Poäng</th>
                            <th>Matcher Vunna</th>
                            <th>Matcher Förlorade</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${groupPlayers.map((player, j) => `
                            <tr id="group-${i}-player-${j}">
                                <td>${player.name}</td>
                                <td>${player.points}</td>
                                <td>${player.won}</td>
                                <td>${player.lost}</td>
                            </tr>`).join("")}
                    </tbody>
                `;

                groupDiv.appendChild(table);
                groupDiv.appendChild(createMatchSchedule(groupPlayers, i));
                container.appendChild(groupDiv);

                groups.push({ players: groupPlayers, matches: matches });
            }

            tournaments.push({ name: tournamentName, groups: groups });
            localStorage.setItem('tournaments', JSON.stringify(tournaments));
        }
    </script>
</body>
</html>
